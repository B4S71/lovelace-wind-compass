console.info("%c WindCompassCard Loaded: V_0.1 ","color: white; background: #607d8b; font-weight: bold;");class t extends HTMLElement{constructor(){super(...arguments),this._bucketSize=5,this._bucketCount=72,this._warnMultiplier=.9,this._historyData=[],this._lastHistoryFetch=0,this._currentUnit="",this._maxSpeed=30,this._currentGust=0}static getConfigElement(){return document.createElement("wind-compass-editor")}static getStubConfig(){return{type:"custom:wind-compass-card",direction_entity:"sensor.wind_direction",speed_entity:"sensor.wind_speed"}}set hass(t){this._hass=t,this._updateCard()}setConfig(t){if(!t.direction_entity)throw new Error("direction_entity is required");if(!t.speed_entity)throw new Error("speed_entity is required");this.config=t}connectedCallback(){this.shadowRoot||(this.attachShadow({mode:"open"}),this._render()),this._resizeObserver=new ResizeObserver(()=>this._updateLayout()),this._resizeObserver.observe(this)}disconnectedCallback(){this._resizeObserver?.disconnect()}_render(){this.shadowRoot&&(this.shadowRoot.innerHTML='\n      <style>\n        :host {\n          display: block;\n          --accent-color: var(--accent-color, #ff9500);\n        }\n        \n        ha-card {\n          height: 100%;\n          background: transparent;\n          box-shadow: var(--ha-card-box-shadow, none);\n          border-radius: var(--ha-card-border-radius, 12px);\n          overflow: hidden;\n        }\n\n        .container {\n          padding: 20px;\n          display: flex;\n          flex-direction: column;\n          gap: 16px;\n          height: 100%;\n          box-sizing: border-box;\n        }\n\n        .compass-wrapper {\n          position: relative;\n          flex: 1;\n          min-height: 120px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n\n        .compass-container {\n          position: relative;\n          width: 100%;\n          height: 100px;\n          background: var(--secondary-background-color, rgba(0,0,0,0.02));\n          border-radius: 16px;\n          overflow: hidden;\n          box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);\n        }\n\n        .compass-tape {\n          position: absolute;\n          top: 0;\n          left: 50%;\n          height: 100%;\n          display: flex;\n          align-items: center;\n          transition: transform 0.3s ease-out;\n          will-change: transform;\n          z-index: 2;\n        }\n\n        .compass-bar {\n          position: absolute;\n          bottom: 0;\n          border-radius: 4px 4px 0 0;\n          pointer-events: none;\n          opacity: 0.6;\n          transition: opacity 0.3s ease, background 0.3s ease;\n        }\n\n        .compass-tick {\n          position: absolute;\n          width: 2px;\n          background: var(--primary-text-color);\n          opacity: 0.15;\n        }\n\n        .compass-label {\n          position: absolute;\n          color: var(--primary-text-color);\n          font-weight: 600;\n          font-size: 14px;\n          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n          transform: translateX(-50%);\n          top: -20px;\n          opacity: 0.7;\n        }\n\n        .compass-marker {\n          position: absolute;\n          left: 50%;\n          top: 0;\n          width: 3px;\n          height: 100%;\n          background: var(--accent-color);\n          border-radius: 2px;\n          transform: translateX(-50%);\n          z-index: 3;\n          box-shadow: 0 2px 8px rgba(255, 149, 0, 0.3);\n        }\n\n        .speed-info {\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-end;\n          gap: 12px;\n        }\n\n        .speed-main {\n          display: flex;\n          align-items: baseline;\n          gap: 4px;\n        }\n\n        .speed-value {\n          font-size: 28px;\n          font-weight: 300;\n          color: var(--primary-text-color);\n          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n          line-height: 1;\n        }\n\n        .speed-unit {\n          font-size: 14px;\n          color: var(--secondary-text-color);\n          font-weight: 400;\n          opacity: 0.7;\n        }\n\n        .speed-gust {\n          font-size: 12px;\n          color: var(--secondary-text-color);\n          opacity: 0.6;\n        }\n\n        .speed-bar-container {\n          flex: 1;\n          display: flex;\n          flex-direction: column;\n          gap: 4px;\n        }\n\n        .speed-bar-bg {\n          position: relative;\n          width: 100%;\n          height: 6px;\n          background: var(--secondary-background-color, rgba(0,0,0,0.08));\n          border-radius: 3px;\n          overflow: hidden;\n        }\n\n        .speed-bar-fill {\n          position: absolute;\n          top: 0;\n          left: 0;\n          height: 100%;\n          background: linear-gradient(90deg, var(--accent-color), #ff6600);\n          border-radius: 3px;\n          transition: width 0.4s ease-out;\n          box-shadow: 0 0 12px rgba(255, 149, 0, 0.3);\n        }\n\n        .speed-bar-label {\n          display: flex;\n          justify-content: space-between;\n          font-size: 11px;\n          color: var(--secondary-text-color);\n          opacity: 0.6;\n        }\n      </style>\n\n      <ha-card>\n        <div class="container">\n          <div class="compass-wrapper">\n            <div class="compass-container">\n              <div class="compass-tape" id="tape"></div>\n              <div class="compass-marker" id="marker"></div>\n            </div>\n          </div>\n\n          <div class="speed-info">\n            <div class="speed-main">\n              <span class="speed-value" id="speedValue">--</span>\n              <span class="speed-unit" id="speedUnit"></span>\n            </div>\n            <div class="speed-gust" id="gustInfo"></div>\n          </div>\n\n          <div class="speed-bar-container">\n            <div class="speed-bar-bg">\n              <div class="speed-bar-fill" id="speedBar"></div>\n            </div>\n            <div class="speed-bar-label">\n              <span>0</span>\n              <span id="maxSpeedLabel">30</span>\n            </div>\n          </div>\n        </div>\n      </ha-card>\n    ')}_updateCard(){if(!this._hass||!this.config)return;const t=this.config.direction_entity,e=this.config.speed_entity,n=this.config.gust_entity,s=this.config.max_speed||30,i=this._hass.states[t],o=this._hass.states[e],a=n?this._hass.states[n]:null;i&&(this._avgDeg=parseFloat(i.state),this._instDeg=parseFloat(i.state)),o&&(this._currentSpeed=parseFloat(o.state),this._currentUnit=o.attributes.unit_of_measurement||"",this._maxSpeed=s),a&&(this._currentGust=parseFloat(a.state));const r=Date.now();r-this._lastHistoryFetch>3e5&&(this._lastHistoryFetch=r,this._fetchHistory(t,e)),this._updateDisplay()}async _fetchHistory(t,e){if(!this._hass)return;const n=new Date,s=new Date(n.getTime()-864e5);try{const i=[t,e].join(","),o=await this._hass.callApi("GET",`history/period/${s.toISOString()}?filter_entity_id=${i}&end_time=${n.toISOString()}&minimal_response`);if(o&&2===o.length){const n=o.find(e=>e.length>0&&e[0].entity_id===t),s=o.find(t=>t.length>0&&t[0].entity_id===e);n&&s&&this._processHistoryData(n,s)}}catch(t){console.error("WindCompass: History fetch failed",t)}}_processHistoryData(t,e){const n=new Array(this._bucketCount).fill(null).map(()=>({duration:0,totalSpeed:0}));let s=0;for(let i=0;i<t.length-1;i++){const o=parseFloat(t[i].state);if(isNaN(o))continue;const a=new Date(t[i].last_changed).getTime(),r=(new Date(t[i+1].last_changed).getTime()-a)/1e3/60;for(;s<e.length-1&&new Date(e[s+1].last_changed).getTime()<=a;)s++;const d=parseFloat(e[s].state)||0,c=Math.floor(o%360/360*this._bucketCount);c>=0&&c<this._bucketCount&&(n[c].duration+=r,n[c].totalSpeed+=d*r)}this._historyData=n,this._updateLayout()}_updateLayout(){if(!this.shadowRoot)return;const t=this.shadowRoot.querySelector(".compass-container");if(!t)return;const e=t.offsetWidth;0!==e&&(this._pxPerDeg=e/360,this._buildTape(),this._updateDisplay())}_buildTape(){if(!this.shadowRoot||!this._pxPerDeg)return;const t=this.shadowRoot.querySelector("#tape");if(!t)return;t.innerHTML="";let e=1;this._historyData.forEach(t=>{if(t.duration>0){const n=t.totalSpeed/t.duration;n>e&&(e=n)}});const n=this._bucketSize*this._pxPerDeg,s=Math.max(1,n-1);for(let n=-180;n<=540;n+=this._bucketSize){const i=n*this._pxPerDeg,o=(n%360+360)%360,a=Math.floor(o/this._bucketSize);if(a>=0&&a<this._bucketCount){const n=this._historyData[a];if(n&&n.duration>0){const o=n.totalSpeed/n.duration,a=o/e*100,r=document.createElement("div");r.className="compass-bar",r.style.left=`${i}px`,r.style.width=`${s}px`,r.style.height=`${Math.max(3,.8*a)}%`,r.style.background=o>.8*this._maxSpeed?"var(--error-color, #ff3b30)":"var(--accent-color)",t.appendChild(r)}}const r=document.createElement("div");if(r.className="compass-tick",r.style.left=`${i}px`,o%90==0){r.style.height="100%",r.style.opacity="0.25";const e=document.createElement("div");e.className="compass-label";const n={0:"N",90:"E",180:"S",270:"W"};e.textContent=n[o]||"",e.style.left=`${i}px`,t.appendChild(e),t.appendChild(r)}else o%45==0&&(r.style.height="80%",r.style.top="10%",r.style.opacity="0.2",t.appendChild(r))}}_updateDisplay(){if(!this.shadowRoot)return;this.shadowRoot.querySelector("#marker");const t=this.shadowRoot.querySelector("#tape");void 0!==this._avgDeg&&this._pxPerDeg&&t&&(t.style.transform=`translateX(-${this._avgDeg*this._pxPerDeg}px)`);const e=this.shadowRoot.querySelector("#speedValue"),n=this.shadowRoot.querySelector("#speedUnit"),s=this.shadowRoot.querySelector("#gustInfo"),i=this.shadowRoot.querySelector("#speedBar"),o=this.shadowRoot.querySelector("#maxSpeedLabel");if(e&&void 0!==this._currentSpeed&&(e.textContent=Math.round(this._currentSpeed).toString()),n&&(n.textContent=this._currentUnit||""),s&&this._currentGust>0&&(s.textContent=`Gusts: ${Math.round(this._currentGust)} ${this._currentUnit}`),i&&void 0!==this._currentSpeed){const t=Math.min(100,this._currentSpeed/this._maxSpeed*100);i.style.width=`${t}%`}o&&(o.textContent=this._maxSpeed.toString())}getCardSize(){return 3}}customElements.define("wind-compass-card",t),window.customCards=window.customCards||[],window.customCards.push({type:"wind-compass-card",name:"Wind Compass Card",preview:!0,description:"Professional wind direction compass card"});
//# sourceMappingURL=wind-compass-card.js.map
