const t=[{name:"display_mode",label:"Anzeigemodus",selector:{select:{mode:"dropdown",options:[{value:"analog",label:"Analog (Klassisch)"},{value:"digital",label:"Digital (Hybrid)"}]}}},{name:"font_style",label:"Schriftart",selector:{select:{mode:"dropdown",options:[{value:"standard",label:"Standard (Apple Bold)"},{value:"thin",label:"Modern & Dünn (iOS)"},{value:"retro",label:"Retro Bahnhof (DIN-Style)"}]}}}];class e extends HTMLElement{constructor(){super(...arguments),this._ticks=[],this._lastMin=-1,this._lastSecond=-1}static getConfigElement(){return document.createElement("squircle-clock-editor")}static getStubConfig(){return{type:"custom:squircle-clock-card",display_mode:"analog",font_style:"standard"}}set hass(t){this._hass=t}setConfig(t){this.config=t,this.shadowRoot&&(this._render(),this._drawContent())}getLayoutOptions(){return{grid_rows:2,grid_columns:2,grid_min_rows:1,grid_min_columns:1}}connectedCallback(){this.shadowRoot||this.attachShadow({mode:"open"}),this._render(),this._drawContent(),this._startClock(),this._resizeObserver=new ResizeObserver(()=>this._drawContent()),this._resizeObserver.observe(this)}disconnectedCallback(){this._stopClock(),this._resizeObserver?.disconnect()}_startClock(){this._timer&&cancelAnimationFrame(this._timer);const t=()=>{const e=new Date;let n=e,i=this.config.timezone;if(this.config.timezone_entity&&this._hass){const t=this._hass.states[this.config.timezone_entity];t&&t.state&&(i=t.state)}if(i)try{const t=e.toLocaleString("en-US",{timeZone:i});n=new Date(t),n.setMilliseconds(e.getMilliseconds())}catch(t){n=e}"digital"===this.config.display_mode?this._updateDigital(n):this._updateAnalog(n),this._timer=requestAnimationFrame(t)};this._timer=requestAnimationFrame(t)}_stopClock(){this._timer&&cancelAnimationFrame(this._timer)}_getPointOnRoundedRect(t,e,n,i,s){const o=(t-90)*(Math.PI/180),a=e/2,r=n/2,l=Math.max(0,e-2*s),d=Math.max(0,n-2*s),h=Math.max(0,i-s),c=l/2,m=d/2,g=Math.abs(Math.cos(o));let u,_;c*Math.abs(Math.sin(o))<=m*g?(u=c*Math.sign(Math.cos(o)),_=c*Math.tan(o)*Math.sign(Math.cos(o))):(u=m/Math.tan(o)*Math.sign(Math.sin(o)),_=m*Math.sign(Math.sin(o)));const f=Math.max(0,c-h),y=Math.max(0,m-h);if(Math.abs(u)>f&&Math.abs(_)>y){const t=Math.abs(u)-f,e=Math.abs(_)-y,n=Math.sqrt(t*t+e*e);u=(f+t/n*h)*Math.sign(u),_=(y+e/n*h)*Math.sign(_)}return{x:a+u,y:r+_}}_getFontStyle(){switch(this.config.font_style||"standard"){case"thin":return'\n                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;\n                font-weight: 200;\n              ';case"retro":return'\n                font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\n                font-weight: 700;\n                letter-spacing: 0.5px;\n              ';default:return'\n                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;\n                font-weight: 600;\n              '}}_render(){this.shadowRoot&&(this.shadowRoot.innerHTML=`\n      <style>\n        :host {\n          display: block; width: 100%; height: 100%;\n          background: var(--ha-card-background, var(--card-background-color, white));\n          border-radius: var(--ha-card-border-radius, 12px);\n          box-shadow: var(--ha-card-box-shadow, none);\n          overflow: hidden;\n          box-sizing: border-box;\n          position: relative;\n        }\n        svg { width: 100%; height: 100%; display: block; position: absolute; top: 0; left: 0; }\n        \n        /* Analog Styles */\n        text.analog-num {\n          ${this._getFontStyle()}\n          fill: var(--primary-text-color); \n          text-anchor: middle; dominant-baseline: middle;\n        }\n        #hour-hand, #minute-hand { stroke: var(--primary-text-color); stroke-width: 6; stroke-linecap: round; }\n        #second-hand { stroke: #ff9500; stroke-width: 2.5; stroke-linecap: round; }\n        #center-dot { fill: #ff9500; stroke: var(--primary-text-color); stroke-width: 1.5; }\n\n        /* Digital Styles */\n        .digital-container {\n            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);\n            text-align: center; \n            color: var(--primary-text-color); pointer-events: none;\n            ${this._getFontStyle()}\n        }\n        .time-big { font-size: 1em; line-height: 1; font-variant-numeric: tabular-nums; }\n        .date-small { \n            font-weight: 500; \n            opacity: 0.6; \n            margin-top: 4px; \n            text-transform: uppercase; \n            font-weight: ${"thin"===this.config.font_style?"400":"bold"};\n        }\n        \n        /* Aktiver Sekunden-Tick (Digital) */\n        .active-tick { \n            stroke: #ff9500 !important; \n            stroke-opacity: 1 !important; \n            stroke-width: 3px !important; \n        }\n      </style>\n      <div id="content"></div>\n    `)}_drawContent(){if(!this.shadowRoot)return;const t=this.shadowRoot.getElementById("content");if(!t)return;const e=this.getBoundingClientRect(),n=e.width||300,i=e.height||300,s=Math.min(n,i),o=window.getComputedStyle(this);let a=parseFloat(o.borderTopLeftRadius);o.borderTopLeftRadius&&o.borderTopLeftRadius.includes("%")&&(a=s*parseFloat(o.borderTopLeftRadius)/100);const r=a||.22*s;"analog"===(this.config.display_mode||"analog")?this._drawAnalog(t,n,i,r,s):this._drawDigital(t,n,i,r,s)}_drawAnalog(t,e,n,i,s){let o="";for(let t=0;t<60;t++){const s=t%5==0,a=6*t,r=this._getPointOnRoundedRect(a,e,n,i,5),l=this._getPointOnRoundedRect(a,e,n,i,s?20:12),d=s?"var(--primary-text-color)":"var(--secondary-text-color)";let h=s?3:1.5;"retro"===this.config.font_style&&s&&(h=4.5),"retro"!==this.config.font_style||s||(h=2),o+=`<line x1="${l.x}" y1="${l.y}" x2="${r.x}" y2="${r.y}" stroke="${d}" stroke-width="${h}" stroke-linecap="round" />`}const a=this._getPointOnRoundedRect(0,e,n,i,.25*s),r=this._getPointOnRoundedRect(90,e,n,i,.25*s),l=this._getPointOnRoundedRect(180,e,n,i,.25*s),d=this._getPointOnRoundedRect(270,e,n,i,.25*s);t.innerHTML=`\n      <svg viewBox="0 0 ${e} ${n}">\n        ${o}\n        <text class="analog-num" style="font-size: ${Math.max(12,s/10)}px" x="${a.x}" y="${a.y}">12</text>\n        <text class="analog-num" style="font-size: ${Math.max(12,s/10)}px" x="${r.x}" y="${r.y}">3</text>\n        <text class="analog-num" style="font-size: ${Math.max(12,s/10)}px" x="${l.x}" y="${l.y}">6</text>\n        <text class="analog-num" style="font-size: ${Math.max(12,s/10)}px" x="${d.x}" y="${d.y}">9</text>\n        <line id="hour-hand" x1="${e/2}" y1="${n/2}" x2="${e/2}" y2="${n/2-s/4}" />\n        <line id="minute-hand" x1="${e/2}" y1="${n/2}" x2="${e/2}" y2="${n/2-s/2.8}" />\n        <line id="second-hand" x1="${e/2}" y1="${n/2+15}" x2="${e/2}" y2="${n/2-s/2.4}" />\n        <circle id="center-dot" cx="${e/2}" cy="${n/2}" r="3.5" />\n      </svg>\n    `,this.hourHand=this.shadowRoot?.querySelector("#hour-hand"),this.minuteHand=this.shadowRoot?.querySelector("#minute-hand"),this.secondHand=this.shadowRoot?.querySelector("#second-hand"),this._center={x:e/2,y:n/2}}_drawDigital(t,e,n,i,s){let o="";for(let t=0;t<60;t++){const s=6*t,a=this._getPointOnRoundedRect(s,e,n,i,6),r=this._getPointOnRoundedRect(s,e,n,i,14);o+=`<line id="tick-${t}" x1="${r.x}" y1="${r.y}" x2="${a.x}" y2="${a.y}" \n                stroke="var(--secondary-text-color)" \n                stroke-opacity="0.4" \n                stroke-width="1.5" \n                stroke-linecap="round" />`}t.innerHTML=`\n      <svg viewBox="0 0 ${e} ${n}">${o}</svg>\n      <div class="digital-container">\n        <div class="time-big" id="time-display" style="font-size: ${.25*s}px">--:--</div>\n        <div class="date-small" id="date-display" style="font-size: ${.08*s}px">--</div>\n      </div>\n    `,this._timeDisplay=this.shadowRoot?.querySelector("#time-display"),this._dateDisplay=this.shadowRoot?.querySelector("#date-display"),this._ticks=[];for(let t=0;t<60;t++)this._ticks.push(this.shadowRoot?.querySelector(`#tick-${t}`)||null);this._lastMin=-1,this._lastSecond=-1;const a=new Date;if(this.config.timezone)try{const t=a.toLocaleString("en-US",{timeZone:this.config.timezone}),e=new Date(t);this._updateDigital(e,!0)}catch(t){this._updateDigital(a,!0)}else this._updateDigital(a,!0)}_updateAnalog(t){if(!this.hourHand)return;const e=t.getSeconds()+t.getMilliseconds()/1e3,n=t.getMinutes()+e/60,i=t.getHours()%12+n/60,{x:s,y:o}=this._center||{x:0,y:0};this.secondHand?.setAttribute("transform",`rotate(${6*e} ${s} ${o})`),this.minuteHand?.setAttribute("transform",`rotate(${6*n} ${s} ${o})`),this.hourHand.setAttribute("transform",`rotate(${30*i} ${s} ${o})`)}_updateDigital(t,e=!1){if(!this._timeDisplay)return;const n=t.getSeconds();if(e||this._lastMin!==t.getMinutes()){const e=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0");this._timeDisplay.textContent=`${e}:${n}`;const i={...{weekday:"short",day:"numeric"}};this.config.timezone&&(i.timeZone=this.config.timezone),this._dateDisplay&&(this._dateDisplay.textContent=(new Date).toLocaleDateString("de-DE",i)),this._lastMin=t.getMinutes()}(e||this._lastSecond!==n)&&(-1!==this._lastSecond&&this._ticks[this._lastSecond]&&this._ticks[this._lastSecond]?.classList.remove("active-tick"),this._ticks[n]&&this._ticks[n]?.classList.add("active-tick"),this._lastSecond=n)}}class n extends HTMLElement{setConfig(t){this._config=t}set hass(t){this._hass=t,this._form&&(this._form.hass=t)}connectedCallback(){this._render()}_render(){this._form||(this._form=document.createElement("ha-form"),this._form.schema=t,this._form.computeLabel=t=>t.label||t.name,this._form.addEventListener("value-changed",t=>this._valueChanged(t)),this.appendChild(this._form)),this._form.data=this._config,this._hass&&(this._form.hass=this._hass)}_valueChanged(t){const e={...this._config,...t.detail.value},n=new CustomEvent("config-changed",{detail:{config:e},bubbles:!0,composed:!0});this.dispatchEvent(n)}}customElements.define("squircle-clock-card",e),customElements.define("squircle-clock-editor",n),window.customCards=window.customCards||[],window.customCards.push({type:"squircle-clock-card",name:"Squircle Clock Card",preview:!0,description:"Native HA-Konfiguration verfügbar."});
//# sourceMappingURL=squircle-clock-card.js.map
